<!doctype html>
<html>
    <head>
        <!-- META -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="/imgs/favicon.ico">
        <!-- Optimize mobile viewport -->
        <title>To-do</title>
        <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" href="bower_components/animate.css/animate.min.css">
        <link rel="stylesheet" type="text/css" href="/css/login.css">
        <script src="bower_components/jquery/dist/jquery.min.js"></script>
        <body>
            <div class="container">
                <form class="login" action="/login" method='post'>
                    <fieldset>
                        <legend class="legend">Login</legend>
                        <div class="input">
                            <input name="username" type="text" placeholder="userName" required/>
                            <span>
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </div>
                        <div class="input">
                            <input name="pwd" type="password" placeholder="Password" required/>
                            <span>
                                <i class="fa fa-lock"></i>
                            </span>
                        </div>
                        <button type="submit" class="submit">
                            <i class="fa fa-long-arrow-right"></i>
                        </button>
                        <a href="/signup">sign up</a>
                    </fieldset>
                    <div class="feedback"></div>

                </form>
            </div>
        </body>
    </html>

    <script type="text/javascript">
        $(document).ready(function() {
            $(".input").focusin(function() {
                $(this).find("span").animate({
                    "opacity": "0"
                }, 200);
            });

            $(".input").focusout(function() {
                $(this).find("span").animate({
                    "opacity": "1"
                }, 300);
            });

            $('.login').submit(function(e) {
                e.preventDefault();
                var form = $(this);
                $.ajax({
                    url: '/login',
                    method: 'post',
                    dataType:"json",
                    data: form.serialize(),
                    success: function(data) {
                      //cant successlly get msg
                       if(data.status !== 200){
                           appendFeedback(data.msg);
                           return;
                       }
                       //if success jump to index
                       location.href= '/';
                    },
                    error: function(error) {
                        console.log('error', error)
                    }
                });
            })

            $('.login').click(function () {
              if($(this).hasClass('error')){
                console.log('545345');
                $('.feedback').empty();
                $('.login').find(".submit i").removeAttr('class').addClass("fa fa-long-arrow-right").css({"color": "#fff"});
                $('.submit i').removeClass("fa-times").addClass('fa-long-arrow-right');
                $(this).removeClass('error');
              }
            })

            function appendFeedback(msg) {
                $('.login').addClass('error');
                $('.feedback').append(msg);
                $('.submit i').removeClass("fa-long-arrow-right").addClass('fa-times');

            }
        })
    </script>
